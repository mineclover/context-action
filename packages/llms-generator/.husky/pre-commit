#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# YAML 프론트매터 자동 업데이트 시스템
echo "🔍 Checking for document changes..."

# 변경된 문서 파일 검색
CHANGED_DOCS=$(git diff --cached --name-only | grep -E '^docs/.+\.md$')
CHANGED_TEMPLATES=$(git diff --cached --name-only | grep -E '^data/.+\.md$')

if [ -n "$CHANGED_DOCS" ]; then
  echo "📝 Source documents changed, updating frontmatter..."
  npx tsx packages/llms-generator/src/cli/hooks/update-frontmatter.ts --source-changed "$CHANGED_DOCS"
fi

if [ -n "$CHANGED_TEMPLATES" ]; then
  echo "📋 Template documents changed, updating status..."
  npx tsx packages/llms-generator/src/cli/hooks/update-frontmatter.ts --template-changed "$CHANGED_TEMPLATES"
fi

# 프론트매터 일관성 검증
echo "✅ Validating frontmatter consistency..."
npx tsx packages/llms-generator/src/cli/hooks/validate-frontmatter.ts

echo "🎉 Frontmatter updates completed!"