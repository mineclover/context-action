#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# YAML í”„ë¡ íŠ¸ë§¤í„° ìë™ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ
echo "ğŸ” Checking for document changes..."

# ë³€ê²½ëœ ë¬¸ì„œ íŒŒì¼ ê²€ìƒ‰
CHANGED_DOCS=$(git diff --cached --name-only | grep -E '^docs/.+\.md$')
CHANGED_TEMPLATES=$(git diff --cached --name-only | grep -E '^data/.+\.md$')

if [ -n "$CHANGED_DOCS" ]; then
  echo "ğŸ“ Source documents changed, updating frontmatter..."
  npx tsx packages/llms-generator/src/cli/hooks/update-frontmatter.ts --source-changed "$CHANGED_DOCS"
fi

if [ -n "$CHANGED_TEMPLATES" ]; then
  echo "ğŸ“‹ Template documents changed, updating status..."
  npx tsx packages/llms-generator/src/cli/hooks/update-frontmatter.ts --template-changed "$CHANGED_TEMPLATES"
fi

# í”„ë¡ íŠ¸ë§¤í„° ì¼ê´€ì„± ê²€ì¦
echo "âœ… Validating frontmatter consistency..."
npx tsx packages/llms-generator/src/cli/hooks/validate-frontmatter.ts

echo "ğŸ‰ Frontmatter updates completed!"