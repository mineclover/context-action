#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Git merge í›„ ë¬¸ì„œ ë™ê¸°í™” (pullì´ë‚˜ merge í›„ ì‹¤í–‰)
echo "ğŸ”€ Merge í›„ ë¬¸ì„œ ë™ê¸°í™”ë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."

# ìµœê·¼ mergeì—ì„œ ë³€ê²½ëœ íŒŒì¼ë“¤ ê°ì§€
CHANGED_FILES=$(git diff HEAD~1 --name-only | grep -E '\.(md|txt)$' | tr '\n' ',' | sed 's/,$//')

if [ -n "$CHANGED_FILES" ]; then
  echo "ğŸ“„ ë³€ê²½ëœ ë¬¸ì„œë“¤: $CHANGED_FILES"
  
  # ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ pnpm cli ì‚¬ìš©
  cd packages/llms-generator && pnpm cli sync-docs --changed-files "$CHANGED_FILES" --quiet
  
  if [ $? -eq 0 ]; then
    echo "âœ… Merge í›„ ë¬¸ì„œ ë™ê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
  else
    echo "âš ï¸ Merge í›„ ë¬¸ì„œ ë™ê¸°í™” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
  fi
else
  echo "ğŸ“„ ë³€ê²½ëœ ë¬¸ì„œê°€ ì—†ì–´ ë™ê¸°í™”ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤."
fi